<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Macro for typesafe `gio::Settings` key access."><title>gen_settings in gsettings_macro - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-081576b923113409.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="gsettings_macro" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0 (129f3b996 2024-06-10)" data-channel="1.79.0" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-e32f0c247825364d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc attr"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../gsettings_macro/index.html">gsettings_macro</a><span class="version">0.2.0</span></h2></div><div class="sidebar-elems"></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../gsettings_macro/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Attribute Macro <a href="index.html">gsettings_macro</a>::<wbr><a class="attr" href="#">gen_settings</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/gsettings_macro/lib.rs.html#285">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>#[gen_settings]</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Macro for typesafe <a href="https://docs.rs/gio/latest/gio/struct.Settings.html"><code>gio::Settings</code></a> key access.</p>
<p>The macro’s main purpose is to reduce the risk of mistyping a key,
using the wrong method to access values, inputting incorrect values,
and to reduce boilerplate. Additionally, the summary, description,
and default value are included in the documentation of each generated
method. This would be beneficial if you use tools like
<a href="https://rust-analyzer.github.io/"><code>rust-analyzer</code></a>.</p>
<p><strong>⚠️ IMPORTANT ⚠️</strong></p>
<p>Both <code>gio</code> and <code>glib</code> need to be in scope, so unless they are direct crate
dependencies, you need to import them because <code>gen_settings</code> is using
them internally. For example:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gtk::{gio, glib};</code></pre></div>
<h4 id="example"><a class="doc-anchor" href="#example">§</a>Example</h4>
<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gsettings_macro::gen_settings;

<span class="attr">#[gen_settings(file = <span class="string">"./tests/io.github.seadve.test.gschema.xml"</span>)]
</span><span class="kw">pub struct </span>ApplicationSettings;

<span class="kw">let </span>settings = ApplicationSettings::new(<span class="string">"io.github.seadve.test"</span>);

<span class="comment">// `i` D-Bus type
</span>settings.set_window_width(<span class="number">100</span>);
<span class="macro">assert_eq!</span>(settings.window_width(), <span class="number">100</span>);

<span class="comment">// enums
</span>settings.set_alert_sound(AlertSound::Glass);
<span class="macro">assert_eq!</span>(settings.alert_sound(), AlertSound::Glass);

<span class="comment">// bitflags
</span>settings.set_space_style(SpaceStyle::BEFORE_COLON | SpaceStyle::BEFORE_COMMA);
<span class="macro">assert_eq!</span>(
    settings.space_style(),
    SpaceStyle::BEFORE_COLON | SpaceStyle::BEFORE_COMMA
);</code></pre></div>
<p>Note: The file path is relative to the project root or where the
<code>Cargo.toml</code> file is located.</p>
<h4 id="generated-methods"><a class="doc-anchor" href="#generated-methods">§</a>Generated methods</h4>
<p>The procedural macro generates the following <a href="https://docs.rs/gio/latest/gio/struct.Settings.html"><code>gio::Settings</code></a> methods
for each key in the schema:</p>
<ul>
<li><code>set</code> -&gt; <code>set_${key}</code>, which panics when writing in a readonly
key, and <code>try_set_${key}</code>, which behaves the same as the original method.</li>
<li><code>get</code> -&gt; <code>${key}</code></li>
<li><code>connect_changed</code> -&gt; <code>connect_${key}_changed</code></li>
<li><code>bind</code> -&gt; <code>bind_${key}</code></li>
<li><code>create_action</code> -&gt; <code>create_${key}_action</code></li>
<li><code>default_value</code> -&gt; <code>${key}_default_value</code></li>
<li><code>reset</code> -&gt; <code>reset_${key}</code></li>
</ul>
<h4 id="known-d-bus-type-signatures"><a class="doc-anchor" href="#known-d-bus-type-signatures">§</a>Known D-Bus type signatures</h4>
<p>The setter and getter methods has the following parameter and
return type, depending on the key’s type signature.</p>
<div><table><thead><tr><th>Type Signature</th><th>Parameter Type</th><th>Return Type</th></tr></thead><tbody>
<tr><td>b</td><td><code>bool</code></td><td><code>bool</code></td></tr>
<tr><td>i</td><td><code>i32</code></td><td><code>i32</code></td></tr>
<tr><td>u</td><td><code>u32</code></td><td><code>u32</code></td></tr>
<tr><td>x</td><td><code>i64</code></td><td><code>i64</code></td></tr>
<tr><td>t</td><td><code>u64</code></td><td><code>u64</code></td></tr>
<tr><td>d</td><td><code>f64</code></td><td><code>f64</code></td></tr>
<tr><td>(ii)</td><td><code>(i32, i32</code>)</td><td><code>(i32, i32</code>)</td></tr>
<tr><td>as</td><td><code>&amp;[&amp;str]</code></td><td><code>Vec&lt;String&gt;</code></td></tr>
<tr><td>s *</td><td><code>&amp;str</code></td><td><code>String</code></td></tr>
</tbody></table>
</div>
<p>* If the key of type signature <code>s</code> has no <code>choice</code> attribute
specified in the GSchema, the parameter and return types stated
in the table would be applied. Otherwise, it will generate an
enum, like described in the next section, and use it as the parameter
and return types, instead of <code>&amp;str</code> and <code>String</code> respectively.</p>
<p>It will not compile if the type signature is not defined above.
However, it is possible to explicitly skip generating methods
for a specific key or type signature using the attribute
<code>#[gen_settings_skip]</code>, or define a custom parameter and return
types using <code>#[gen_settings_define]</code> attribute. The usage of
the latter will be further explained in the following sections.</p>
<h4 id="enums-and-flags"><a class="doc-anchor" href="#enums-and-flags">§</a>Enums and Flags</h4>
<p>The macro will also automatically generate enums or flags. If it is
an enum, it would generated a normal Rust enum with each nick
specified in the GSchema converted to pascal case as an enum variant.
The enum would implement both <a href="https://docs.rs/glib/latest/glib/variant/trait.ToVariant.html"><code>ToVariant</code></a> and <a href="https://docs.rs/glib/latest/glib/variant/trait.FromVariant.html"><code>FromVariant</code></a>, <a href="https://doc.rust-lang.org/1.79.0/core/clone/trait.Clone.html" title="trait core::clone::Clone"><code>Clone</code></a>,
<a href="https://doc.rust-lang.org/1.79.0/core/hash/macros/derive.Hash.html" title="derive core::hash::macros::Hash"><code>Hash</code></a>, <a href="https://doc.rust-lang.org/1.79.0/core/cmp/trait.PartialEq.html" title="trait core::cmp::PartialEq"><code>PartialEq</code></a>, <a href="https://doc.rust-lang.org/1.79.0/core/cmp/trait.Eq.html" title="trait core::cmp::Eq"><code>Eq</code></a>, <a href="https://doc.rust-lang.org/1.79.0/core/cmp/trait.PartialOrd.html" title="trait core::cmp::PartialOrd"><code>PartialOrd</code></a>, and <a href="https://doc.rust-lang.org/1.79.0/core/cmp/trait.Ord.html" title="trait core::cmp::Ord"><code>Ord</code></a>. On
the other hand, if it is a flag, it would generate bitflags
same as the bitflags generated by the <a href="https://docs.rs/bitflags/latest/bitflags/macro.bitflags.html"><code>bitflags</code></a> macro with each
nick specified in the GSchema converted to screaming snake case as
a const flag.</p>
<p>The generated types, enum or bitflags, would have the same
visibility and scope with the generated struct.</p>
<h4 id="skipping-methods-generation"><a class="doc-anchor" href="#skipping-methods-generation">§</a>Skipping methods generation</h4>
<p>This would be helpful if you want to have full control
with the key without the macro intervening. For example:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gsettings_macro::gen_settings;

<span class="attr">#[gen_settings(
    file = <span class="string">"./tests/io.github.seadve.test.gschema.xml"</span>,
    id = <span class="string">"io.github.seadve.test"
</span>)]
</span><span class="comment">// Skip generating methods for keys with type signature `(ss)`
</span><span class="attr">#[gen_settings_skip(signature = <span class="string">"(ss)"</span>)]
</span><span class="comment">// Skip generating methods for the key of name `some-key-name`
</span><span class="attr">#[gen_settings_skip(key_name = <span class="string">"some-key-name"</span>)]
</span><span class="kw">pub struct </span>Settings;

<span class="kw">impl </span>Settings {
    <span class="kw">pub fn </span>set_some_key_name(value: <span class="kw-2">&amp;</span>std::path::Path) {
        ...
    }
}</code></pre></div>
<h4 id="defining-custom-types"><a class="doc-anchor" href="#defining-custom-types">§</a>Defining custom types</h4>
<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gsettings_macro::gen_settings;

<span class="kw">use </span>std::path::{Path, PathBuf};

<span class="attr">#[gen_settings(file = <span class="string">"./tests/io.github.seadve.test.gschema.xml"</span>)]
</span><span class="comment">// Define custom parameter and return types for keys with type `(ss)`
</span><span class="attr">#[gen_settings_define(
    signature = <span class="string">"(ss)"</span>,
    arg_type = <span class="string">"(&amp;str, &amp;str)"</span>,
    ret_type = <span class="string">"(String, String)"
</span>)]
</span><span class="comment">// Define custom parameter and return types for key with name `cache-dir`
</span><span class="attr">#[gen_settings_define(key_name = <span class="string">"cache-dir"</span>, arg_type = <span class="string">"&amp;Path"</span>, ret_type = <span class="string">"PathBuf"</span>)]
</span><span class="kw">pub struct </span>SomeAppSettings;

<span class="kw">let </span>settings = SomeAppSettings::new(<span class="string">"io.github.seadve.test"</span>);

settings.set_cache_dir(Path::new(<span class="string">"/some_dir"</span>));
<span class="macro">assert_eq!</span>(settings.cache_dir(), PathBuf::from(<span class="string">"/some_dir"</span>));

settings.set_string_tuple((<span class="string">"hi"</span>, <span class="string">"hi2"</span>));
<span class="macro">assert_eq!</span>(settings.string_tuple(), (<span class="string">"hi"</span>.into(), <span class="string">"hi2"</span>.into()));</code></pre></div>
<p>The type specified in <code>arg_type</code> and <code>ret_type</code> has to be on scope or
you can specify the full path.</p>
<p>If you somehow do not want an enum parameter and return types for <code>s</code>
type signature with choices. You can also use this to override that behavior.</p>
<p>Note: The type has to implement both <a href="https://docs.rs/glib/latest/glib/variant/trait.ToVariant.html"><code>ToVariant</code></a> and <a href="https://docs.rs/glib/latest/glib/variant/trait.FromVariant.html"><code>FromVariant</code></a> or it
would fail to compile.</p>
<h4 id="default-trait"><a class="doc-anchor" href="#default-trait">§</a>Default trait</h4>
<p>The schema id can be specified as an attribute, making it implement
<a href="https://doc.rust-lang.org/1.79.0/core/default/trait.Default.html" title="trait core::default::Default"><code>Default</code></a> and create a <code>new</code> constructor without parameters.
Otherwise, it will not implement <a href="https://doc.rust-lang.org/1.79.0/core/default/trait.Default.html" title="trait core::default::Default"><code>Default</code></a> and would require the
schema id as an parameter in the the constructor or the <code>new</code> method.</p>
<p>The following is an example of defining the <code>id</code> attribute in the macro:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>gsettings_macro::gen_settings;

<span class="attr">#[gen_settings(
    file = <span class="string">"./tests/io.github.seadve.test.gschema.xml"</span>,
    id = <span class="string">"io.github.seadve.test"
</span>)]
</span><span class="kw">pub struct </span>ApplicationSettings;

<span class="comment">// The id is specified above so it is not needed
// to specify it in the constructor.
</span><span class="kw">let </span>settings = ApplicationSettings::new();
<span class="kw">let </span>another_instance = ApplicationSettings::default();</code></pre></div>
</div></details></section></div></main></body></html>